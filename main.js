var L=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var M=(h,c)=>{for(var e in c)L(h,e,{get:c[e],enumerable:!0})},R=(h,c,e,t)=>{if(c&&typeof c=="object"||typeof c=="function")for(let a of T(c))!x.call(h,a)&&a!==e&&L(h,a,{get:()=>c[a],enumerable:!(t=F(c,a))||t.enumerable});return h};var O=h=>R(L({},"__esModule",{value:!0}),h);var P={};M(P,{default:()=>u});module.exports=O(P);var l=require("obsidian");var S=`
    body.is-focus-mode .mobile-toolbar,
    body.is-focus-mode .mobile-toolbar-container,
    body.is-focus-mode .workspace-drawer-tab-container {
        display: none !important;
    }
`,v="ordinary.md",A=[{id:".",symbol:"\u22EF"},{id:"-",symbol:"\u2014"},{id:",",symbol:"\xB7"}],C="@",p={TASK:"task.md",PLAN:"plan.md",LATER:"later.md",WORK:"work.md"},m={MAX_REPEAT:20,FOLDER_PATH:"legacy",DATE_FORMAT:"YYYYMMDDHHmmss"};var u=class extends l.Plugin{constructor(){super(...arguments);this.lastKey="";this.repeatCount=0}async onload(){this.injectStyles(),this.addCommand({id:"move-cursor-to-end",name:"\uCEE4\uC11C\uC640 \uD3EC\uCEE4\uC2A4\uB97C \uBB38\uC11C \uB05D\uC73C\uB85C \uC774\uB3D9",hotkeys:[{modifiers:["Mod"],key:"]"}],editorCallback:e=>this.moveCursorToEnd(e)}),this.addCommand({id:"move-cursor-to-start",name:"\uCEE4\uC11C\uC640 \uD3EC\uCEE4\uC2A4\uB97C \uBB38\uC11C \uCC98\uC74C\uC73C\uB85C \uC774\uB3D9",hotkeys:[{modifiers:["Mod"],key:"["}],editorCallback:e=>this.moveCursorToStart(e)}),this.addCommand({id:"copy-all-document",name:"\uBB38\uC11C \uC804\uCCB4 \uBCF5\uC0AC",editorCallback:e=>this.copyAll(e)}),this.addCommand({id:"cut-all-document",name:"\uBB38\uC11C \uC804\uCCB4 \uC798\uB77C\uB0B4\uAE30",editorCallback:e=>this.cutAll(e)}),this.addCommand({id:"cut-to-clipboard",name:"\uC798\uB77C\uB0B4\uAE30",icon:"lucide-scissors",hotkeys:[{modifiers:["Mod"],key:"X"}],editorCallback:e=>this.handleCutCopy(e,!0)}),this.addCommand({id:"copy-to-clipboard",name:"\uBCF5\uC0AC\uD558\uAE30",icon:"copy",hotkeys:[{modifiers:["Mod"],key:"C"}],editorCallback:e=>this.handleCutCopy(e,!1)}),this.addCommand({id:"focus-next-leaf",name:"\uB2E4\uC74C \uD0ED\uC5D0 \uD3EC\uCEE4\uC2A4",hotkeys:[{modifiers:["Mod"],key:"'"}],callback:()=>this.cycleLeafFocus("forward")}),this.addCommand({id:"focus-prev-leaf",name:"\uC774\uC804 \uD0ED\uC5D0 \uD3EC\uCEE4\uC2A4",hotkeys:[{modifiers:["Mod"],key:";"}],callback:()=>this.cycleLeafFocus("backward")}),this.addCommand({id:"extract-heading-range",name:"heading \uBC94\uC704 \uCD94\uCD9C",icon:"lucide-heading",editorCallback:(e,t)=>this.startHeadingWorkflow(e,t)}),this.addCommand({id:"toggle-focus-mode",name:"\uC9D1\uC911 \uBAA8\uB4DC \uD1A0\uAE00",hotkeys:[{modifiers:["Mod"],key:"Enter"}],callback:()=>this.toggleFocusMode()}),this.addRibbonIcon("lucide-save","\uB808\uAC70\uC2DC \uD30C\uC77C \uB9CC\uB4E4\uAE30",()=>{let e=this.app.workspace.getActiveFile();e?this.createLegacyFile(e):new l.Notice("\uD65C\uC131\uD654\uB41C \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.")}),this.addCommand({id:"create-legacy-file",name:"\uD604\uC7AC \uBB38\uC11C\uC758 \uB808\uAC70\uC2DC \uD30C\uC77C \uB9CC\uB4E4\uAE30",hotkeys:[{modifiers:["Mod"],key:"S"}],checkCallback:e=>{let t=this.app.workspace.getActiveFile();return t&&t.extension==="md"?(e||this.createLegacyFile(t),!0):!1}}),this.registerDomEvent(document,"keydown",e=>{this.handleAbnormalInput(e)}),this.addRibbonIcon("lucide-git-fork","\uB85C\uCEEC \uADF8\uB798\uD504 \uC5F4\uAE30",()=>this.openGraphInSidebar()),this.addCommand({id:"open-localgraph-in-sidebar",name:"\uC624\uB978\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uB85C\uCEEC\uADF8\uB798\uD504 \uC5F4\uAE30",callback:()=>this.openGraphInSidebar()}),this.addRibbonIcon("lucide-library-big","\uB098\uC911\uC5D0 \uBCF4\uAE30 \uC5F4\uAE30",()=>{this.openFileNormal(p.LATER)}),this.addRibbonIcon("lucide-file-pen","\uC791\uC5C5 \uBB38\uC11C \uC5F4\uAE30",()=>{this.openFileWithCleanup(p.WORK)}),this.addCommand({id:"open-later-file",name:"\uB098\uC911\uC5D0 \uBCF4\uAE30 \uC5F4\uAE30",hotkeys:[{modifiers:["Mod"],key:"L"}],callback:()=>this.openFileNormal(p.LATER)}),this.addCommand({id:"open-work-file",name:"\uC791\uC5C5 \uBB38\uC11C \uC5F4\uAE30",hotkeys:[{modifiers:["Mod"],key:"Q"}],callback:()=>this.openFileWithCleanup(p.WORK)}),this.addRibbonIcon("calendar","\uC77C\uC0C1\uB178\uD2B8 \uC5F4\uAE30",()=>this.openOrCreateOrdinaryNote()),this.addCommand({id:"open-ordinary-note",name:"\uC77C\uC0C1\uB178\uD2B8 \uC5F4\uAE30",hotkeys:[{modifiers:["Mod"],key:"D"}],callback:()=>this.openOrCreateOrdinaryNote()}),this.addCommand({id:"move-sidebar-panel",name:"\uC0AC\uC774\uB4DC\uBC14 \uD328\uB110 \uC774\uB3D9",callback:()=>{this.openSidebarSelector(e=>{let t=`${e==="left"?"\uC67C\uCABD":"\uC624\uB978\uCABD"}\uC5D0\uC11C \uC774\uB3D9\uD560 \uD328\uB110 \uC120\uD0DD`;new k(this.app,e,a=>{this.moveLeafToOppositeSidebar(a,e)},t).open()})}}),this.addCommand({id:"close-sidebar-panel",name:"\uC0AC\uC774\uB4DC\uBC14 \uD328\uB110 \uB2EB\uAE30",callback:()=>{this.openSidebarSelector(e=>{let t=`${e==="left"?"\uC67C\uCABD":"\uC624\uB978\uCABD"}\uC5D0\uC11C \uB2EB\uC744 \uD328\uB110 \uC120\uD0DD`;new k(this.app,e,a=>{a.detach(),new l.Notice("\uD328\uB110\uC774 \uB2EB\uD614\uC2B5\uB2C8\uB2E4.")},t).open()})}}),this.addCommand({id:"expand-selection-char-right",name:"\uC120\uD0DD \uC601\uC5ED \uD55C \uAE00\uC790 \uC624\uB978\uCABD\uC73C\uB85C \uD655\uC7A5",hotkeys:[{modifiers:["Alt"],key:"ArrowRight"}],editorCallback:e=>this.expandChar(e,1)}),this.addCommand({id:"expand-selection-char-left",name:"\uC120\uD0DD \uC601\uC5ED \uD55C \uAE00\uC790 \uC67C\uCABD\uC73C\uB85C \uD655\uC7A5",hotkeys:[{modifiers:["Alt"],key:"ArrowLeft"}],editorCallback:e=>this.expandChar(e,-1)}),this.addCommand({id:"expand-selection-word-right",name:"\uC120\uD0DD \uC601\uC5ED \uB2E8\uC5B4 \uB2E8\uC704 \uC624\uB978\uCABD\uC73C\uB85C \uD655\uC7A5",hotkeys:[{modifiers:["Mod"],key:"ArrowRight"}],editorCallback:e=>this.expandWord(e,"right")}),this.addCommand({id:"expand-selection-word-left",name:"\uC120\uD0DD \uC601\uC5ED \uB2E8\uC5B4 \uB2E8\uC704 \uC67C\uCABD\uC73C\uB85C \uD655\uC7A5",hotkeys:[{modifiers:["Mod"],key:"ArrowLeft"}],editorCallback:e=>this.expandWord(e,"left")}),this.registerEditorSuggest(new b(this)),this.addCommand({id:"add-tags-property",name:"\uD0DC\uADF8 \uC18D\uC131 \uCD94\uAC00",icon:"tags",hotkeys:[{modifiers:["Mod"],key:"\\"}],callback:()=>{let e=this.app.workspace.getActiveFile();e&&this.app.fileManager.processFrontMatter(e,t=>{t.hasOwnProperty("tags")||(t.tags=null)})}}),this.addRibbonIcon("lucide-list-check","task-plan \uC5F4\uAE30",()=>this.openSplitFiles()),this.addCommand({id:"open-split-taskplan",name:"task-plan \uC5F4\uAE30",hotkeys:[{modifiers:["Mod"],key:"R"}],callback:()=>this.openSplitFiles()}),this.addCommand({id:"move-line-taskplan",name:"task-plan \uC774\uB3D9",hotkeys:[{modifiers:["Mod"],key:"E"}],editorCallback:(e,t)=>this.handleLineMove(e,t)})}onunload(){document.body.classList.remove("is-focus-mode")}moveCursorToEnd(e){e.focus();let t=e.lineCount()-1,a={line:t,ch:e.getLine(t).length};e.setCursor(a),e.scrollIntoView({from:a,to:a},!0)}moveCursorToStart(e){e.focus();let t={line:0,ch:0};e.setCursor(t),e.scrollIntoView({from:t,to:t},!0)}async copyAll(e){await navigator.clipboard.writeText(e.getValue()),new l.Notice("\uBB38\uC11C \uC804\uCCB4\uAC00 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}async cutAll(e){let t=e.getValue();t&&(await navigator.clipboard.writeText(t),e.setValue(""),new l.Notice("\uBB38\uC11C \uC804\uCCB4\uB97C \uC798\uB77C\uB0C8\uC2B5\uB2C8\uB2E4."))}async handleCutCopy(e,t){let a=e.getSelection().length>0;if(!a){let n=e.getCursor();e.setSelection({line:n.line,ch:0},{line:n.line,ch:e.getLine(n.line).length})}let i=e.getSelection();i&&(await navigator.clipboard.writeText(i),t?e.replaceSelection(""):a||e.setCursor(e.getCursor("to")))}cycleLeafFocus(e){let{workspace:t}=this.app,a=t.activeLeaf,i=[];if(t.iterateRootLeaves(s=>{i.push(s)}),i.length<=1)return;let n=i.findIndex(s=>s===a),o;e==="forward"?o=(n+1)%i.length:o=(n-1+i.length)%i.length;let r=i[o];if(r){t.setActiveLeaf(r,{focus:!0});let s=r.view;typeof s.focus=="function"&&s.focus()}}startHeadingWorkflow(e,t){if(!t.file)return;let i=this.app.metadataCache.getFileCache(t.file)?.headings||[],n=[{label:"\uC2DC\uC791: \uBB38\uC11C \uCC98\uC74C\uBD80\uD130",line:0,isSpecial:!0},...i.map(o=>({label:`${"#".repeat(o.level)} ${o.heading}`,line:o.position.start.line,level:o.level}))];new y(this.app,n,"\uCD94\uCD9C \uC2DC\uC791 \uC704\uCE58 \uC120\uD0DD",o=>{let r=[{label:"\uB2E8\uC77C \uD5E4\uB529 \uAD6C\uAC04\uB9CC",line:-1,isSpecial:!0},...i.filter(s=>s.position.start.line>o.line).map(s=>({label:`\uC885\uB8CC: ${s.heading} \uAE4C\uC9C0`,line:s.position.end.line,level:s.level}))];new y(this.app,r,"\uC885\uB8CC \uC704\uCE58 \uC120\uD0DD",s=>this.executeExtraction(e,o,s,i)).open()}).open()}async executeExtraction(e,t,a,i){let n=e.lineCount()-1,o=this.calculateEndLine(t,a,i,n),r={from:{line:t.line,ch:0},to:{line:o,ch:e.getLine(o).length}},s=e.getRange(r.from,r.to);if(!s.trim())return;let d=await this.getUniqueFileName("\uBB34\uC81C"),f=await this.app.vault.create(d,s);e.replaceRange("",r.from,r.to),await this.app.workspace.getLeaf("tab").openFile(f)}calculateEndLine(e,t,a,i){if(!t.isSpecial){let o=a.find(r=>r.position.start.line>t.line&&r.level<=(t.level||0));return o?o.position.start.line-1:i}let n=a.find(o=>o.position.start.line>e.line&&o.level<=(e.level||0));return n?n.position.start.line-1:i}async getUniqueFileName(e){let t=`${e}.md`,a=1;for(;this.app.vault.getAbstractFileByPath(t);)t=`${e} ${a++}.md`;return t}toggleFocusMode(){document.body.classList.toggle("is-focus-mode")}injectStyles(){let e=document.createElement("style");e.id="integrated-plugin-styles",e.textContent=S,document.head.appendChild(e),this.register(()=>e.detach())}handleAbnormalInput(e){let t=this.app.workspace.getActiveFile();!t||t.extension!=="md"||!e.target.closest(".cm-content")||(e.isComposing||e.key.length>1)&&e.key!=="Backspace"&&e.key!=="Enter"||(this.lastKey===e.key?this.repeatCount++:(this.lastKey=e.key,this.repeatCount=1),this.repeatCount>=m.MAX_REPEAT&&this.emergencyAction(t))}async emergencyAction(e){this.repeatCount=0,this.lastKey="",await this.createLegacyFile(e),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),new l.Notice(`\u26A0\uFE0F \uBE44\uC815\uC0C1 \uC785\uB825 \uAC10\uC9C0: '${e.basename}' \uBC31\uC5C5 \uD6C4 \uD3EC\uCEE4\uC2A4\uB97C \uD574\uC81C\uD588\uC2B5\uB2C8\uB2E4.`)}async createLegacyFile(e){let t=m.FOLDER_PATH,a=(0,l.moment)().format(m.DATE_FORMAT),i=(0,l.normalizePath)(`${t}/${e.basename}_legacy_${a}.md`);try{await this.app.vault.adapter.exists(t)||await this.app.vault.createFolder(t),await this.app.vault.copy(e,i),new l.Notice(`\uB808\uAC70\uC2DC \uD30C\uC77C \uC800\uC7A5\uB428: ${e.basename}_legacy_${a}`)}catch{new l.Notice("\uD30C\uC77C \uBCF5\uC0AC \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.")}}async openGraphInSidebar(){let e=this.app.workspace.getLeavesOfType("localgraph")[0]||this.app.workspace.getRightLeaf(!1);await e.setViewState({type:"localgraph",active:!0}),this.app.workspace.revealLeaf(e)}async openFileNormal(e){let t=this.app.vault.getAbstractFileByPath(e);t instanceof l.TFile&&await this.app.workspace.getLeaf(!1).openFile(t)}async openFileWithCleanup(e){let{workspace:t,vault:a}=this.app,i=a.getAbstractFileByPath(e);if(!(i instanceof l.TFile)){new l.Notice("\uD30C\uC77C\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let n=t.getLeaf(!1);await n.openFile(i);let o=[];t.iterateAllLeaves(r=>{r.getRoot()===t.rootSplit&&r!==n&&o.push(r)}),o.forEach(r=>r.detach()),t.setActiveLeaf(n,{focus:!0})}async openOrCreateOrdinaryNote(){let e=this.app.vault.getAbstractFileByPath(v);e instanceof l.TFile||(e=await this.app.vault.create(v,""));let t=this.app.workspace.getLeaf(!1);await t.openFile(e);let a=t.view.editor,i=`### ${(0,l.moment)().format("MM\uC6D4 DD\uC77C (ddd)")}`;if(!a.getValue().includes(i)){let n=a.getValue().length>0?`
`:"";a.replaceRange(`${n}${i}
`,{line:a.lineCount(),ch:0})}this.moveCursorToEnd(a)}openSidebarSelector(e){let t=new class extends l.SuggestModal{getSuggestions(){return["left","right"]}renderSuggestion(a,i){i.setText(a==="left"?"\uC67C\uCABD \uC0AC\uC774\uB4DC\uBC14":"\uC624\uB978\uCABD \uC0AC\uC774\uB4DC\uBC14")}onChooseSuggestion(a){e(a)}}(this.app);t.setPlaceholder("\uC0AC\uC774\uB4DC\uBC14\uB97C \uC120\uD0DD\uD558\uC138\uC694"),t.open()}moveLeafToOppositeSidebar(e,t){let a=t==="left"?"right":"left",i=e.getViewState(),n=a==="left"?this.app.workspace.getLeftLeaf(!1):this.app.workspace.getRightLeaf(!1);n&&n.setViewState(i).then(()=>{e.detach(),this.app.workspace.revealLeaf(n),new l.Notice(`\uD328\uB110\uC774 ${a==="left"?"\uC67C\uCABD":"\uC624\uB978\uCABD"}\uC73C\uB85C \uC774\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`)})}updateSelections(e,t){e.setSelections(e.listSelections().map(a=>({anchor:a.anchor,head:t(a)})))}expandChar(e,t){this.updateSelections(e,a=>({line:a.head.line,ch:Math.max(0,Math.min(e.getLine(a.head.line).length,a.head.ch+t))}))}expandWord(e,t){this.updateSelections(e,a=>{let i=e.getLine(a.head.line);if(t==="left"){let n=i.substring(0,a.head.ch).match(/(\S+\s*|\s+)$/);return{line:a.head.line,ch:n?a.head.ch-n[0].length:0}}else{let n=i.substring(a.head.ch).match(/^(\s*\S+|\s+)/);return{line:a.head.line,ch:n?a.head.ch+n[0].length:i.length}}})}async openSplitFiles(){let{workspace:e}=this.app,t=this.app.vault.getAbstractFileByPath(p.TASK),a=this.app.vault.getAbstractFileByPath(p.PLAN);if(!t||!a){new l.Notice("\uD30C\uC77C\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let i=e.getLeavesOfType("markdown"),n=e.getLeavesOfType("empty"),o=d=>i.find(f=>f.view.file?.path===d),r=o(p.TASK),s=o(p.PLAN);if(r&&s){new l.Notice("\uC774\uBBF8 \uBAA8\uB4E0 \uCC3D\uC774 \uAD6C\uC131\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4.");return}if(r&&!s){e.setActiveLeaf(r),await(n.length>0?n[0]:e.getLeaf("split","vertical")).openFile(a);return}if(!r&&s){e.setActiveLeaf(s),await e.getLeaf("split","vertical").openFile(a),await s.openFile(t);return}if(!r&&!s){let d=e.getLeavesOfType("markdown"),f;if(d.length>0){f=d[0];for(let g=1;g<d.length;g++)d[g].detach()}else{let g=e.getLeavesOfType("empty");f=g.length>0?g[0]:e.getLeaf(!1)}await f.openFile(t),e.setActiveLeaf(f),await e.getLeaf("split","vertical").openFile(a);return}}async handleLineMove(e,t){let a=t.file?.path,i=a===p.TASK?p.PLAN:a===p.PLAN?p.TASK:null;if(!i)return;let n=e.getCursor().line,o=e.getLine(n);if(!o.trim())return;let r=this.app.workspace.getLeavesOfType("markdown").find(s=>s.view.file?.path===i);if(r){let s=r.view.editor,d=s.getValue(),E=(d.length>0&&!d.endsWith(`
`)?`
`:"")+o;s.replaceRange(E,{line:s.lineCount(),ch:0});let g={line:n,ch:0},w={line:n+1,ch:0};n===e.lineCount()-1&&n>0&&(g.line=n-1,g.ch=e.getLine(n-1).length,w.line=n,w.ch=o.length),e.replaceRange("",g,w),this.app.workspace.setActiveLeaf(r,{focus:!0})}}},y=class extends l.SuggestModal{constructor(e,t,a,i){super(e);this.options=t;this.onChoose=i;this.setPlaceholder(a)}getSuggestions(e){return this.options.filter(t=>t.label.toLowerCase().includes(e.toLowerCase()))}renderSuggestion(e,t){t.createEl("div",{text:e.label})}onChooseSuggestion(e){this.onChoose(e)}},k=class extends l.SuggestModal{constructor(e,t,a,i){super(e);this.side=t;this.action=a;this.setPlaceholder(i)}getSuggestions(e){let t=[],a=this.side==="left"?this.app.workspace.leftSplit:this.app.workspace.rightSplit;return this.app.workspace.iterateAllLeaves(i=>{i.getRoot()===a&&t.push({name:i.getDisplayText(),leaf:i})}),t.filter(i=>i.name.toLowerCase().includes(e.toLowerCase()))}renderSuggestion(e,t){t.setText(e.name)}onChooseSuggestion(e){this.action(e.leaf)}},b=class extends l.EditorSuggest{constructor(c){super(c.app)}onTrigger(c,e){let a=e.getLine(c.line).substring(0,c.ch).match(new RegExp(`\\${C}([^\\${C}\\s]*)$`));return a?{start:{line:c.line,ch:a.index},end:c,query:a[1]}:null}getSuggestions(c){return A.filter(e=>e.id.toLowerCase().includes(c.query.toLowerCase()))}renderSuggestion(c,e){e.setText(`${c.id} ${c.symbol}`)}selectSuggestion(c){this.context?.editor.replaceRange(c.symbol,this.context.start,this.context.end)}};
