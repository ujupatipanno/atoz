var h=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var v=(s,e)=>{for(var t in e)h(s,t,{get:e[t],enumerable:!0})},E=(s,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of k(e))!L.call(s,n)&&n!==t&&h(s,n,{get:()=>e[n],enumerable:!(a=C(e,n))||a.enumerable});return s};var T=s=>E(h({},"__esModule",{value:!0}),s);var O={};v(O,{default:()=>d});module.exports=T(O);var o=require("obsidian"),x=`
    body.is-focus-mode .mobile-toolbar,
    body.is-focus-mode .mobile-toolbar-container,
    body.is-focus-mode .workspace-drawer-tab-container {
        display: none !important;
    }
`,y=[{id:"task",path:"task.md",name:"\uD560 \uC77C \uBB38\uC11C \uC5F4\uAE30",icon:"lucide-square-check"},{id:"later",path:"later.md",name:"\uB098\uC911\uC5D0 \uBCF4\uAE30 \uC5F4\uAE30",icon:"lucide-library-big"},{id:"plan",path:"plan.md",name:"\uACC4\uD68D \uBB38\uC11C \uC5F4\uAE30",icon:"lucide-goal"},{id:"work",path:"work.md",name:"\uC791\uC5C5 \uBB38\uC11C \uC5F4\uAE30",icon:"lucide-file-pen"}],F=[{id:".",symbol:"\u22EF"},{id:"-",symbol:"\u2014"},{id:",",symbol:"\xB7"}],b="@",w="ordinary.md",d=class extends o.Plugin{async onload(){this.injectFocusStyles(),this.registerEditorSuggest(new m(this)),this.addRibbonIcon("lucide-save","\uB808\uAC70\uC2DC \uD30C\uC77C \uB9CC\uB4E4\uAE30",()=>{let e=this.app.workspace.getActiveFile();e?this.createLegacyFile(e):new o.Notice("\uD65C\uC131\uD654\uB41C \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.")}),this.addRibbonIcon("lucide-git-fork","\uB85C\uCEEC \uADF8\uB798\uD504 \uC5F4\uAE30",()=>this.openGraphInSidebar());for(let e of y)this.addRibbonIcon(e.icon,e.name,()=>{this.openTargetFile(e.path)});this.addRibbonIcon("calendar","\uC77C\uC0C1\uB178\uD2B8 \uC5F4\uAE30",()=>this.openOrCreateOrdinaryNote()),this.addCommand({id:"copy-all-document",name:"\uBB38\uC11C \uC804\uCCB4 \uBCF5\uC0AC",editorCallback:e=>this.copyAll(e)}),this.addCommand({id:"cut-to-clipboard",name:"\uC798\uB77C\uB0B4\uAE30",icon:"lucide-scissors",editorCallback:e=>this.handleCutCopy(e,!0)}),this.addCommand({id:"copy-to-clipboard",name:"\uBCF5\uC0AC\uD558\uAE30",icon:"copy",editorCallback:e=>this.handleCutCopy(e,!1)}),this.addCommand({id:"toggle-focus-mode",name:"\uC9D1\uC911 \uBAA8\uB4DC \uD1A0\uAE00",callback:()=>this.toggleFocusMode()}),this.addCommand({id:"create-legacy-file",name:"\uD604\uC7AC \uBB38\uC11C\uC758 \uB808\uAC70\uC2DC \uD30C\uC77C \uB9CC\uB4E4\uAE30",checkCallback:e=>{let t=this.app.workspace.getActiveFile();return t?(e||this.createLegacyFile(t),!0):!1}}),this.addCommand({id:"open-localgraph-in-sidebar",name:"\uC624\uB978\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uB85C\uCEEC\uADF8\uB798\uD504 \uC5F4\uAE30",callback:()=>this.openGraphInSidebar()});for(let e of y)this.addCommand({id:`open-${e.id}-file`,name:e.name,callback:()=>this.openTargetFile(e.path)});this.addCommand({id:"open-ordinary-note",name:"\uC77C\uC0C1\uB178\uD2B8 \uC5F4\uAE30",callback:()=>this.openOrCreateOrdinaryNote()}),this.addCommand({id:"move-sidebar-panel",name:"\uC0AC\uC774\uB4DC\uBC14 \uD328\uB110 \uC774\uB3D9 (\uC120\uD0DD)",callback:()=>{this.openSidebarSelector(e=>{let t=`${e==="left"?"\uC67C\uCABD":"\uC624\uB978\uCABD"}\uC5D0\uC11C \uC774\uB3D9\uD560 \uD328\uB110 \uC120\uD0DD`;new p(this.app,e,a=>{this.moveLeafToOppositeSidebar(a,e)},t).open()})}}),this.addCommand({id:"close-sidebar-panel",name:"\uC0AC\uC774\uB4DC\uBC14 \uD328\uB110 \uB2EB\uAE30 (\uC120\uD0DD)",callback:()=>{this.openSidebarSelector(e=>{let t=`${e==="left"?"\uC67C\uCABD":"\uC624\uB978\uCABD"}\uC5D0\uC11C \uB2EB\uC744 \uD328\uB110 \uC120\uD0DD`;new p(this.app,e,a=>{a.detach(),new o.Notice("\uD328\uB110\uC774 \uB2EB\uD614\uC2B5\uB2C8\uB2E4.")},t).open()})}}),this.addCommand({id:"scroll-to-bottom",name:"\uBB38\uC11C \uB9E8 \uC544\uB798\uB85C \uC2A4\uD06C\uB864",editorCallback:e=>this.scrollToBottom(e)}),this.addCommand({id:"expand-selection-char-right",name:"\uC120\uD0DD \uC601\uC5ED \uD55C \uAE00\uC790 \uC624\uB978\uCABD\uC73C\uB85C \uD655\uC7A5",editorCallback:e=>this.expandChar(e,1)}),this.addCommand({id:"expand-selection-char-left",name:"\uC120\uD0DD \uC601\uC5ED \uD55C \uAE00\uC790 \uC67C\uCABD\uC73C\uB85C \uD655\uC7A5",editorCallback:e=>this.expandChar(e,-1)}),this.addCommand({id:"expand-selection-word-right",name:"\uC120\uD0DD \uC601\uC5ED \uB2E8\uC5B4 \uB2E8\uC704 \uC624\uB978\uCABD\uC73C\uB85C \uD655\uC7A5",editorCallback:e=>this.expandWord(e,"right")}),this.addCommand({id:"expand-selection-word-left",name:"\uC120\uD0DD \uC601\uC5ED \uB2E8\uC5B4 \uB2E8\uC704 \uC67C\uCABD\uC73C\uB85C \uD655\uC7A5",editorCallback:e=>this.expandWord(e,"left")}),this.addCommand({id:"swap-splits",name:"\uBD84\uD560 \uD0ED \uAD50\uD658",callback:()=>this.swapTabsBetweenTwoSplits()}),this.addCommand({id:"add-tags-property",name:"\uD0DC\uADF8 \uC18D\uC131 \uCD94\uAC00",icon:"tags",callback:()=>{let e=this.app.workspace.getActiveFile();e&&this.app.fileManager.processFrontMatter(e,t=>{t.hasOwnProperty("tags")||(t.tags=null)})}})}onunload(){document.body.classList.remove("is-focus-mode")}async copyAll(e){await navigator.clipboard.writeText(e.getValue()),new o.Notice("\uBB38\uC11C \uC804\uCCB4\uAC00 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}async handleCutCopy(e,t){let a=e.getSelection().length>0;if(!a){let i=e.getCursor(),r=e.getLine(i.line),l={line:i.line,ch:0},c={line:i.line,ch:r.length};e.setSelection(l,c)}let n=e.getSelection();if(n)try{if(await navigator.clipboard.writeText(n),t)e.replaceSelection("");else if(!a){let i=e.getCursor("to");e.setCursor(i)}}catch{new o.Notice("\uD074\uB9BD\uBCF4\uB4DC \uC811\uADFC \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.")}}toggleFocusMode(){document.body.classList.toggle("is-focus-mode")}injectFocusStyles(){let e=document.createElement("style");e.id="focus-mode-styles",e.textContent=x,document.head.appendChild(e),this.register(()=>e.detach())}async createLegacyFile(e){let t="legacy",a=(0,o.moment)().format("YYYYMMDDHHmmss"),n=(0,o.normalizePath)(`${t}/${e.basename}_legacy_${a}.md`);try{await this.app.vault.adapter.exists(t)||await this.app.vault.createFolder(t),await this.app.vault.copy(e,n),new o.Notice(`\uB808\uAC70\uC2DC \uD30C\uC77C \uC0DD\uC131 \uC644\uB8CC: ${e.basename}_legacy_${a}`)}catch{new o.Notice("\uD30C\uC77C \uBCF5\uC0AC \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.")}}async openGraphInSidebar(){let{workspace:e}=this.app,t=e.getLeavesOfType("localgraph")[0]||e.getRightLeaf(!1);await t.setViewState({type:"localgraph",active:!0}),e.revealLeaf(t)}async openTargetFile(e){let t=this.app.vault.getAbstractFileByPath(e);t instanceof o.TFile&&await this.app.workspace.getLeaf(!1).openFile(t)}async openOrCreateOrdinaryNote(){try{let e=this.app.vault.getAbstractFileByPath(w);e instanceof o.TFile||(e=await this.app.vault.create(w,""));let t=this.app.workspace.getLeaf(!1);await t.openFile(e);let a=t.view.editor,n=`### ${(0,o.moment)().format("MM\uC6D4 DD\uC77C (ddd)")}`,i=a.getValue();if(!i.includes(n)){let l=i.length>0?`
`:"";a.replaceRange(`${l}${n}
`,{line:a.lineCount(),ch:0})}let r=a.lineCount()-1;a.setCursor({line:r,ch:a.getLine(r).length}),a.scrollIntoView({from:a.getCursor(),to:a.getCursor()},!0),a.focus()}catch{new o.Notice("\uC77C\uC0C1\uB178\uD2B8 \uCC98\uB9AC \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.")}}openSidebarSelector(e){let t=new class extends o.SuggestModal{getSuggestions(){return["left","right"]}renderSuggestion(a,n){n.setText(a==="left"?"\uC67C\uCABD \uC0AC\uC774\uB4DC\uBC14":"\uC624\uB978\uCABD \uC0AC\uC774\uB4DC\uBC14")}onChooseSuggestion(a){e(a)}}(this.app);t.setPlaceholder("\uC0AC\uC774\uB4DC\uBC14\uB97C \uC120\uD0DD\uD558\uC138\uC694"),t.open()}moveLeafToOppositeSidebar(e,t){let a=t==="left"?"right":"left",n=e.getViewState(),i=a==="left"?this.app.workspace.getLeftLeaf(!1):this.app.workspace.getRightLeaf(!1);i&&i.setViewState(n).then(()=>{e.detach(),this.app.workspace.revealLeaf(i),new o.Notice(`\uD328\uB110\uC774 ${a==="left"?"\uC67C\uCABD":"\uC624\uB978\uCABD"}\uC73C\uB85C \uC774\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`)})}scrollToBottom(e){let t=e.lineCount()-1,a=e.getLine(t).length;e.scrollIntoView({from:{line:t,ch:a},to:{line:t,ch:a}},!0)}updateSelections(e,t){let a=e.listSelections().map(n=>({anchor:n.anchor,head:t(n)}));e.setSelections(a)}expandChar(e,t){this.updateSelections(e,a=>{let n=e.getLine(a.head.line),i=Math.max(0,Math.min(n.length,a.head.ch+t));return{line:a.head.line,ch:i}})}expandWord(e,t){this.updateSelections(e,a=>{let{line:n,ch:i}=a.head,r=e.getLine(n);if(t==="left"){let c=r.substring(0,i).match(/(\S+\s*|\s+)$/);return{line:n,ch:c?i-c[0].length:0}}else{let c=r.substring(i).match(/^(\s*\S+|\s+)/);return{line:n,ch:c?i+c[0].length:r.length}}})}async swapTabsBetweenTwoSplits(){let e=this.app.workspace,t=e.getLayout??e._getLayout;if(typeof t!="function"){new o.Notice("\uB808\uC774\uC544\uC6C3\uC744 \uAC00\uC838\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let a=t.call(e),n=a?.main,i=u(n);if(!i){new o.Notice("\uD604\uC7AC \uB450 \uBD84\uD560\uC5D0\uC11C\uB9CC \uB3D9\uC791\uD569\uB2C8\uB2E4.");return}let[r,l]=i.children,c=P(a,i.__path,[l,r]),S=[e.setLayout,e.changeLayout,e.loadLayout];for(let f of S)if(typeof f=="function")try{await f.call(e,c);return}catch{}new o.Notice("\uB808\uC774\uC544\uC6C3 \uC801\uC6A9 \uC2E4\uD328: \uD50C\uB7EC\uADF8\uC778 \uBC84\uC804/\uD658\uACBD\uC744 \uD655\uC778\uD558\uC138\uC694.")}},p=class extends o.SuggestModal{constructor(t,a,n,i){super(t);this.sidebar=a;this.action=n;this.setPlaceholder(i)}getSuggestions(t){let a=[],n=this.sidebar==="left"?this.app.workspace.leftSplit:this.app.workspace.rightSplit;return this.app.workspace.iterateAllLeaves(i=>{i.getRoot()===n&&a.push({name:i.getDisplayText()||i.view.getViewType(),leaf:i})}),a.filter(i=>i.name.toLowerCase().includes(t.toLowerCase()))}renderSuggestion(t,a){a.createEl("div",{text:t.name})}onChooseSuggestion(t){this.action(t.leaf)}};function u(s,e=["main"]){if(!s)return null;let t=s.children;if(Array.isArray(t)&&t.length===2){let n={...s};return n.__path=e,n}if(Array.isArray(t))for(let n=0;n<t.length;n++){let i=u(t[n],e.concat(["children",n]));if(i)return i}let a=["root","container","content"];for(let n of a)if(s[n]){let i=u(s[n],e.concat([n]));if(i)return i}return null}function P(s,e,t){let a=g(s),n=a;for(let i=0;i<e.length;i++){let r=e[i];n[r]=g(n[r]),n=n[r]}return Array.isArray(n.children)&&n.children.length===2&&(n.children=t.map(g)),a}function g(s){return s==null?s:JSON.parse(JSON.stringify(s))}var m=class extends o.EditorSuggest{constructor(e){super(e.app)}onTrigger(e,t){let n=t.getLine(e.line).substring(0,e.ch).match(new RegExp(`\\${b}([^\\${b}\\s]*)$`));return n?{start:{line:e.line,ch:n.index},end:e,query:n[1]}:null}getSuggestions(e){let t=e.query.toLowerCase();return F.filter(a=>a.id.toLowerCase().includes(t))}renderSuggestion(e,t){t.setText(`${e.id} ${e.symbol}`)}selectSuggestion(e){this.context?.editor.replaceRange(e.symbol,this.context.start,this.context.end)}};
